# Baseline Audio-Only Training Configuration
# Experiment: Audio-only baseline with synthetic labels (no MIDI)
# Goal: Compare with multi-modal to quantify multi-modal advantage

data:
  # Annotation paths (synthetic labels)
  train_path: data/annotations/synthetic_train.jsonl
  val_path: data/annotations/synthetic_val.jsonl
  test_path: data/annotations/synthetic_test.jsonl

  # Dimensions (6 technical dimensions)
  dimensions:
    - note_accuracy
    - rhythmic_precision
    - dynamics_control
    - articulation
    - pedaling
    - tone_quality

  # Audio settings
  audio_sample_rate: 24000
  max_audio_length: 240000  # 10 seconds at 24kHz
  max_midi_events: 0  # Disable MIDI processing

  # DataLoader settings
  batch_size: 8
  num_workers: 4
  pin_memory: true

  # Augmentation (training only)
  augmentation:
    enabled: true
    pitch_shift:
      enabled: true
      probability: 0.3
      min_semitones: -2
      max_semitones: 2
    time_stretch:
      enabled: true
      probability: 0.3
      min_rate: 0.85
      max_rate: 1.15
    add_noise:
      enabled: true
      probability: 0.2
      min_snr_db: 25
      max_snr_db: 40
    room_acoustics:
      enabled: true
      probability: 0.2
      num_room_types: 5
    compress_audio:
      enabled: true
      probability: 0.15
      bitrates: [128, 192, 256, 320]
    gain_variation:
      enabled: true
      probability: 0.3
      min_db: -6
      max_db: 6
    max_transforms: 3  # Apply at most 3 transforms per sample

model:
  # Architecture dimensions
  audio_dim: 768
  midi_dim: 0  # Disable MIDI branch
  fusion_dim: 768  # Match audio_dim (no fusion needed)
  aggregator_dim: 512
  num_dimensions: 6  # 6 technical dimensions

  # Encoder settings
  mert_model_name: m-a-p/MERT-v1-95M
  freeze_audio_encoder: false
  gradient_checkpointing: true

  # MIDI encoder (disabled)
  midi_hidden_size: 0
  midi_num_layers: 0
  midi_num_heads: 0
  use_midi: false  # Flag to disable MIDI branch

  # Fusion (disabled)
  fusion_num_heads: 0
  fusion_dropout: 0.0
  use_fusion: false  # Flag to disable fusion

  # Aggregator (audio-only)
  lstm_hidden: 256
  lstm_layers: 2
  attention_heads: 4
  aggregator_dropout: 0.2

  # MTL Head
  shared_hidden: 256
  task_hidden: 128
  mtl_dropout: 0.1

training:
  # Training duration (reduced for faster iteration)
  max_epochs: 18
  precision: 16  # Mixed precision (FP16)

  # Optimization
  optimizer: AdamW
  learning_rate: 1e-5  # Default (not used, see backbone_lr and heads_lr)
  backbone_lr: 1e-5  # Lower LR for pre-trained encoders
  heads_lr: 1e-4  # Higher LR for task heads
  weight_decay: 0.01

  # Learning rate schedule
  scheduler: cosine
  warmup_steps: 500
  min_lr: 1e-6

  # Gradient settings
  gradient_clip_val: 1.0
  accumulate_grad_batches: 4  # Effective batch size = 8 * 4 = 32

  # Validation
  val_check_interval: 1.0  # Check every epoch
  limit_val_batches: 1.0  # Use full val set

  # Metrics (add correlation tracking)
  track_correlations: true  # Enable Pearson correlation logging

callbacks:
  # Model checkpointing
  checkpoint:
    monitor: val_loss
    mode: min
    save_top_k: 3
    save_last: true
    dirpath: checkpoints/baseline_audioonly
    filename: audioonly-{epoch:02d}-{val_loss:.4f}

  # Early stopping
  early_stopping:
    monitor: val_loss
    mode: min
    patience: 5
    min_delta: 0.001

  # Learning rate monitoring
  lr_monitor:
    logging_interval: step

logging:
  # Logging frequency
  log_every_n_steps: 50

  # WandB (optional)
  use_wandb: false
  wandb_project: piano-eval-baseline
  wandb_entity: null
  wandb_run_name: baseline-audioonly

  # TensorBoard
  use_tensorboard: true
  tensorboard_logdir: logs/baseline_audioonly

seed: 42
